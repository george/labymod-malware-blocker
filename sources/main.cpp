#include <algorithm>
#include "util.h"

int main() {
    if (!checkElevated()) {
        log("main", "Please run this program as administrator in order to continue.");
        getchar();
        return -1;
    }

    log("main", "Initializing LabyMod malware blocker!");
    log("main", "This program is designed to block the mod's connections to the servers it communicates with "
                "in order to run and download its required payload.");
    log("main", "It should be noted that, while this program is effective against preventing the existing malware "
                "from being downloaded to your PC, it can be bypassed in a few ways. In order to"
                "bypass it, though, that would require the malware to be updated, and "
                "a new domain to be purchased in place of their current downloads page.");

    if (!checkHostsFileExists()) {
        log("main", "Hosts file doesn't exist, attempting to create one for you!");
        createHostsFile();

        if (!checkHostsFileExists()) {
            log("error", "An unknown error occurred while attempting to create the hosts file.");
            getchar();
            return -1;
        }
    }

    log("main", "Writing entries...");

    int status = writeToHostsFile(getNotInHostsFile());

    if (status != 0) {
        log("main", "An unexpected error occurred while attempting to write entries to hosts file!");
    }

    log("main", "Entries successfully written!");
    log("main", "Thank you for using LabyMod Malware Blocker.");

    getchar();

    return 0;
}
